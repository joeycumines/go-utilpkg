{
  "policy": "ALL tasks contained within this blueprint MUST be completed in their entirety. Deferring, skipping, or omitting any part of the plan is strictly prohibited.",
  "sequentialTasks": [
    {
      "sequence": 1,
      "id": "WIN-001",
      "title": "FIX: Remove //go:build linux || darwin from eventloop core source files",
      "description": "Removed //go:build linux || darwin from loop.go, errors.go, abort.go, eventtarget.go, performance.go. All contain cross-platform code with only stdlib imports.",
      "location": "eventloop/loop.go, eventloop/abort.go, eventloop/eventtarget.go, eventloop/errors.go, eventloop/performance.go",
      "status": "done",
      "acceptanceCriteria": [
        "//go:build linux || darwin removed from loop.go, abort.go, eventtarget.go, errors.go, performance.go",
        "All source files compile on darwin (verified via go build ./...)",
        "No new compilation errors introduced"
      ]
    },
    {
      "sequence": 2,
      "id": "WIN-002",
      "title": "FIX: Remove //go:build linux || darwin from goja-eventloop source and test files",
      "description": "Removed build tags from adapter.go and all 53 test files in goja-eventloop/.",
      "location": "goja-eventloop/adapter.go and all *_test.go files",
      "status": "done",
      "acceptanceCriteria": [
        "//go:build linux || darwin removed from adapter.go",
        "//go:build linux || darwin removed from all test files that had it",
        "Platform-specific test files (if any) retain their correct tags",
        "go build ./... passes on darwin"
      ]
    },
    {
      "sequence": 3,
      "id": "WIN-003",
      "title": "FIX: Audit and correct platform-specific build tags on all test files",
      "description": "Audited 150+ test files. Removed tags from 21 cross-platform test files. Added linux||darwin tag to coverage_handlers_test.go (uses raw FD syscalls). Platform-specific files correctly retain their tags.",
      "location": "eventloop/*_test.go",
      "status": "done",
      "acceptanceCriteria": [
        "All *_darwin*.go files have //go:build darwin",
        "All *_linux*.go files have //go:build linux",
        "All *_windows*.go files have //go:build windows",
        "test files with platform-generic code have tags removed",
        "test files using unix syscalls retain linux || darwin tag",
        "go vet ./... passes on darwin"
      ]
    },
    {
      "sequence": 4,
      "id": "WIN-004",
      "title": "VERIFY: Cross-compile eventloop and goja-eventloop for Windows and Linux",
      "description": "Cross-compiled for all 3 platforms. Fixed: EFD_CLOEXEC/EFD_NONBLOCK stubs in wakeup_windows.go, removed tags from abort.go/eventtarget.go/performance.go. All 6 combinations pass.",
      "location": "eventloop/, goja-eventloop/",
      "status": "done",
      "acceptanceCriteria": [
        "GOOS=windows GOARCH=amd64 go build ./eventloop/... succeeds",
        "GOOS=linux GOARCH=amd64 go build ./eventloop/... succeeds",
        "GOOS=windows GOARCH=amd64 go build ./goja-eventloop/... succeeds",
        "GOOS=linux GOARCH=amd64 go build ./goja-eventloop/... succeeds",
        "GOOS=darwin go build ./... succeeds (no regression)"
      ]
    },
    {
      "sequence": 5,
      "id": "WIN-005",
      "title": "VERIFY: Run make all locally (darwin regression check)",
      "description": "make all passes with exit_code=0 on darwin. All eventloop + goja-eventloop tests pass. Zero staticcheck/betteralign issues.",
      "location": ".",
      "status": "done",
      "acceptanceCriteria": [
        "make all passes with exit_code=0",
        "All eventloop tests pass",
        "All goja-eventloop tests pass",
        "Zero staticcheck warnings",
        "Zero betteralign issues"
      ]
    },
    {
      "sequence": 6,
      "id": "LINUX-001",
      "title": "VERIFY: Run make-all-in-container for Linux verification",
      "description": "The config.mk has a warning from Hana: 'Dont you dare forget about Linux / make-all-in-container!!!!' Run make make-all-in-container to verify all tests pass in a Linux Docker container. This catches Linux-specific issues that macOS testing misses. Fix any failures.",
      "location": ".",
      "status": "pending",
      "acceptanceCriteria": [
        "make make-all-in-container passes with exit_code=0",
        "All eventloop tests pass on Linux",
        "All goja-eventloop tests pass on Linux",
        "No Linux-specific compilation errors"
      ]
    },
    {
      "sequence": 7,
      "id": "RACE-001",
      "title": "VERIFY: Comprehensive race detector sweep on eventloop and goja-eventloop",
      "description": "Run go test -race -timeout=6m on both eventloop/ and goja-eventloop/ packages. The standard make all does NOT include -race flag. The baseline blueprint identified 3 specific data races in: (1) TestHandlePollError_StateTransitionFromSleeping, (2) TestClearInterval_RaceCondition_WrapperRunning, (3) TestQueueMicrotask_PanicRecovery. Some may have been fixed already. Run and fix ALL remaining races.",
      "location": "eventloop/, goja-eventloop/",
      "status": "pending",
      "acceptanceCriteria": [
        "go test -race -timeout=6m ./eventloop/... passes with 0 races",
        "go test -race -timeout=6m ./goja-eventloop/... passes with 0 races",
        "All 3 baseline-identified race conditions verified fixed",
        "No timing-dependent or non-deterministic failures"
      ]
    },
    {
      "sequence": 8,
      "id": "RACE-002",
      "title": "VERIFY: Race detector on Linux container",
      "description": "Run go test -race in the Linux container to catch platform-specific race conditions. Linux thread scheduling differs from macOS (different timing, different contention patterns). Some races only manifest on Linux. Use make-all-in-container with GO_TEST_FLAGS='-race -timeout=8m' or equivalent.",
      "location": "eventloop/, goja-eventloop/",
      "status": "pending",
      "acceptanceCriteria": [
        "go test -race passes on Linux for both packages",
        "No Linux-specific race conditions",
        "All tests deterministic on Linux"
      ]
    },
    {
      "sequence": 9,
      "id": "COVERAGE-001",
      "title": "ANALYZE: Identify coverage gaps blocking 90% target on eventloop",
      "description": "Run go test -coverprofile=coverage.out ./eventloop/ and analyze the coverage report. Current coverage: 77.9% on eventloop main package. Need 12.1%+ improvement to reach 90%. Generate detailed HTML report (go tool cover -html=coverage.out) and identify the SPECIFIC uncovered code paths. Focus on: (a) loop.go main loop body, (b) handlePollError paths, (c) shutdown paths, (d) edge cases in timer/promise code, (e) any new code from feature additions that lacks tests. Document findings for COVERAGE-002.",
      "location": "eventloop/",
      "status": "pending",
      "acceptanceCriteria": [
        "Coverage report generated showing per-function coverage",
        "List of specific uncovered code paths identified",
        "Prioritized list of gaps by line count and importance",
        "Clear plan for which tests to write in COVERAGE-002"
      ]
    },
    {
      "sequence": 10,
      "id": "COVERAGE-002",
      "title": "IMPLEMENT: Write tests to achieve 90%+ coverage on eventloop main package",
      "description": "Based on coverage analysis from COVERAGE-001, write targeted tests for all identified uncovered code paths. Focus on paths that contribute the most to the coverage gap. Use test injection via loopTestHooks for hard-to-reach paths (handlePollError, shutdown timing, poll timeout paths). Create platform-specific test files where needed (e.g., //go:build linux || darwin for tests using unix syscalls).",
      "location": "eventloop/",
      "status": "pending",
      "acceptanceCriteria": [
        "eventloop main package coverage >= 90%",
        "All new tests pass with -race flag",
        "No flaky or timing-dependent tests introduced",
        "make all passes"
      ]
    },
    {
      "sequence": 11,
      "id": "TODO-001",
      "title": "RESOLVE: Blob.stream() TODO marker in goja-eventloop adapter",
      "description": "goja-eventloop/adapter.go line 4622 has: '// TODO: Implement ReadableStream when needed'. Blob.stream() currently returns undefined. Implementing a full ReadableStream is a significant undertaking (complex spec involving backpressure, queueing strategies, etc.). Resolution: document this as an INTENTIONAL LIMITATION in the Blob implementation. Replace the TODO with a documentation comment explaining why ReadableStream is not implemented and suggesting alternatives (text() and arrayBuffer() methods which ARE implemented). Update CHANGELOG.",
      "location": "goja-eventloop/adapter.go",
      "status": "pending",
      "acceptanceCriteria": [
        "TODO comment replaced with documented intentional limitation",
        "Blob.stream() still returns undefined (unchanged behavior)",
        "Alternative approaches documented in code comment",
        "Zero remaining TODO/FIXME/HACK action markers in eventloop/ and goja-eventloop/",
        "CHANGELOG updated noting this limitation"
      ]
    },
    {
      "sequence": 12,
      "id": "API-001",
      "title": "IMPLEMENT: crypto.getRandomValues() JS binding",
      "description": "Add crypto.getRandomValues(typedArray) to the existing crypto binding in goja-eventloop/adapter.go bindCrypto(). This is one of the most commonly used Web Crypto APIs. Implementation: fill the provided TypedArray (Uint8Array, Uint16Array, Uint32Array, Int8Array, etc.) with cryptographically random values using Go's crypto/rand package. The function must: (1) accept any integer TypedArray, (2) fill it in-place with random bytes, (3) return the same TypedArray, (4) throw TypeError for non-TypedArray inputs, (5) throw QuotaExceededError (DOMException) if byteLength > 65536.",
      "location": "goja-eventloop/adapter.go",
      "status": "pending",
      "acceptanceCriteria": [
        "crypto.getRandomValues(new Uint8Array(16)) fills array with random bytes",
        "Returns the same TypedArray that was passed in",
        "Works with Uint8Array, Uint16Array, Uint32Array, Int8Array, Int16Array, Int32Array",
        "Throws TypeError for non-TypedArray input (e.g., plain array, number)",
        "Throws QuotaExceededError DOMException if byteLength > 65536",
        "Uses crypto/rand for cryptographic randomness",
        "10+ tests in goja-eventloop/crypto_test.go covering all acceptance criteria",
        "make all passes"
      ]
    },
    {
      "sequence": 13,
      "id": "DOC-001",
      "title": "UPDATE: CHANGELOG and platform documentation for multi-platform support",
      "description": "Update eventloop/CHANGELOG.md to document Windows platform support (removal of linux/darwin build constraints). Update or create platform compatibility documentation describing: supported platforms (linux/darwin/windows), platform-specific implementation details (epoll/kqueue/IOCP), any platform-specific limitations. Also update the feature matrix to show the complete JavaScript API surface.",
      "location": "eventloop/CHANGELOG.md, eventloop/docs/",
      "status": "pending",
      "acceptanceCriteria": [
        "CHANGELOG updated with Windows support entry",
        "Platform support clearly documented (linux amd64/arm64, darwin amd64/arm64, windows amd64)",
        "Platform-specific details documented (kqueue vs epoll vs IOCP)",
        "Known limitations documented (Blob.stream, Intl partial support)"
      ]
    },
    {
      "sequence": 14,
      "id": "DOC-002",
      "title": "UPDATE: goja-eventloop comprehensive API surface documentation",
      "description": "Create or update goja-eventloop/README.md with comprehensive documentation of all 50+ bound JavaScript APIs. Document each category: Timers (setTimeout/setInterval/setImmediate/clear*), Microtasks (queueMicrotask, process.nextTick), Promises (constructor + all/race/allSettled/any/withResolvers/try), AbortController/AbortSignal, Performance API, Console (14 methods), EventTarget/CustomEvent, URL/URLSearchParams, TextEncoder/TextDecoder, Blob, Headers, FormData, DOMException, localStorage/sessionStorage, structuredClone, crypto (randomUUID, getRandomValues), atob/btoa, delay, Symbol.for/keyFor. Include which APIs are native to Goja vs adapter-provided.",
      "location": "goja-eventloop/README.md",
      "status": "pending",
      "acceptanceCriteria": [
        "All 50+ bound APIs documented with descriptions",
        "Clear distinction between adapter-provided vs Goja-native APIs",
        "Usage examples for key API categories",
        "Limitations noted (Blob.stream, Intl, no fetch/Worker)",
        "Link to eventloop core documentation"
      ]
    },
    {
      "sequence": 15,
      "id": "VERIFY-001",
      "title": "FINAL: Fresh make all on darwin with clean test cache",
      "description": "Final verification pass: flush test cache (go clean -testcache) then run make all on darwin. Verify zero test failures, zero staticcheck warnings, zero betteralign issues. All tests must run (not cached) and pass. This is the final darwin gate.",
      "location": ".",
      "status": "pending",
      "acceptanceCriteria": [
        "go clean -testcache completes",
        "make all passes with exit_code=0",
        "All tests run (not cached) and pass",
        "Zero staticcheck warnings",
        "Zero betteralign issues",
        "Zero vet warnings"
      ]
    },
    {
      "sequence": 16,
      "id": "VERIFY-002",
      "title": "FINAL: Linux container verification with clean cache",
      "description": "Final Linux verification: run make make-all-in-container to verify all tests pass in a fresh Linux Docker container. Tests always run fresh in container (no cache). This is the final Linux gate.",
      "location": ".",
      "status": "pending",
      "acceptanceCriteria": [
        "make make-all-in-container passes with exit_code=0",
        "All tests pass on Linux",
        "No platform-specific failures"
      ]
    },
    {
      "sequence": 17,
      "id": "VERIFY-003",
      "title": "FINAL: Coverage report showing 90%+ on eventloop main package",
      "description": "Generate final coverage reports for eventloop and goja-eventloop. Verify eventloop main package meets 90%+ target. Verify goja-eventloop maintains 88%+. Document any intentionally uncovered paths (e.g., Windows IOCP code when testing on darwin, experimental internal variants).",
      "location": "eventloop/, goja-eventloop/",
      "status": "pending",
      "acceptanceCriteria": [
        "eventloop main package coverage >= 90%",
        "goja-eventloop coverage >= 88%",
        "Coverage report generated and reviewed",
        "All intentionally uncovered paths documented with rationale"
      ]
    },
    {
      "sequence": 18,
      "id": "VERIFY-004",
      "title": "FINAL: Confirm CI pipeline configuration for all 3 platforms",
      "description": "Review .github/workflows/make.yaml CI configuration. Verify that with all changes, the CI will pass on ubuntu-latest (Linux), macos-latest (Darwin), and windows-latest (Windows). The Windows build should now compile and run tests (previously may have been broken due to build tags). Verify local cross-compilation checks pass for all platforms. Update blueprint to confirm all tasks DONE.",
      "location": ".github/workflows/make.yaml",
      "status": "pending",
      "acceptanceCriteria": [
        "CI configuration verified for all 3 platforms in matrix",
        "Local cross-compilation checks pass (GOOS=windows, GOOS=linux)",
        "No CI-specific blockers identified",
        "Windows compilation verified working",
        "blueprint.json confirms all 18 tasks DONE"
      ]
    }
  ],
  "completedTasks": {
    "summary": "116+ tasks completed across 9 phases. All represent verified, merged work in the current codebase.",
    "phases": {
      "coverage": {
        "count": 21,
        "ids": "COVERAGE-001 through COVERAGE-021",
        "summary": "Comprehensive test coverage for: thenStandalone, New(), promisify(), runTimers, pollFastMode, ScheduleMicrotask, percentileIndex, handlePollError, drainWakeUpPipe, createWakeFd, Windows poller stubs, Darwin/Linux poller, MicrotaskRing, ChunkedIngress, Promise.Finally, trackRejection, Registry, FastState, SetInterval/ClearInterval race, SetImmediate/ClearImmediate, goja-eventloop adapter"
      },
      "features": {
        "count": 5,
        "ids": "FEATURE-001 through FEATURE-005",
        "summary": "AbortController/AbortSignal (W3C DOM), performance.now()/mark()/measure() (User Timing L2), console.time()/timeEnd()/timeLog(), Promise.withResolvers() (ES2024)"
      },
      "standards": {
        "count": 4,
        "ids": "STANDARDS-001 through STANDARDS-004",
        "summary": "Promise/A+ compliance, HTML5 timers compliance, Microtask ordering compliance, Promise combinator edge cases"
      },
      "performance": {
        "count": 4,
        "ids": "PERF-001 through PERF-004",
        "summary": "O(1) P-Square percentile, timer wheel analysis (SKIPPED), 35+ benchmarks, zero-allocation verification"
      },
      "platform_integration": {
        "count": 6,
        "ids": "PLATFORM-001 through PLATFORM-003, INTEGRATION-001 through INTEGRATION-003",
        "summary": "CI verification (3 OS matrix), race detector (2 races fixed), stress tests, goja integration tests, workload simulation, memory leak detection"
      },
      "documentation": {
        "count": 4,
        "ids": "DOCS-001 through DOCS-004",
        "summary": "API reference, ARCHITECTURE.md, MIGRATION.md, examples"
      },
      "quality": {
        "count": 5,
        "ids": "QUALITY-001 through QUALITY-005",
        "summary": "TODO markers, error handling, thread safety docs, shutdown cleanup, panic safety"
      },
      "expansion": {
        "count": 70,
        "ids": "EXPAND-001 through EXPAND-070",
        "summary": "AbortSignal.any()/timeout(), Promise.try() (ES2025), console full API (14 methods), process.nextTick(), delay(), crypto.randomUUID(), atob/btoa, structuredClone(), EventTarget/CustomEvent, URL/URLSearchParams, TextEncoder/TextDecoder, Blob, localStorage/sessionStorage, Headers, FormData, DOMException, Symbol utilities, fuzz tests, chaos tests, debugging guide, performance guide, examples, Error.cause (ES2022), configurable chunk size, timer batch cancellation, async stack traces, AbortController integration, plus Goja native API verification (WeakMap/WeakSet, Map/Set, ArrayBuffer/DataView/TypedArray, RegExp, Date, JSON, Math, Number, Errors, Proxy/Reflect, Generators/Iterators, Object/Array/String methods, URI functions, Intl)"
      },
      "bugfixes": {
        "count": 13,
        "ids": "BUGFIX-001 through BUGFIX-004, PEERFIX-001 through PEERFIX-009",
        "summary": "FD double-close race, nested promise timeout, nil pointer in logging, Windows build tags, RemoveEventListener, URLSearchParams sort, TextEncoder.encodeInto read count, iterator Symbol.iterator"
      }
    },
    "keyMetrics": {
      "totalTestsAdded": "500+",
      "totalBenchmarks": "50+",
      "eventloopCoverage": "77.9% (pre-90% push)",
      "gojaEventloopCoverage": "88.6%",
      "jsApisImplemented": "50+",
      "gojaNativeApisVerified": "200+",
      "documentationFiles": 6,
      "examplePrograms": 4
    }
  },
  "continuousVerification": {
    "task": "Run 'make all' with full logging after EVERY significant change",
    "description": "Execute 'make make-all-with-log' after: (a) Each code change, (b) Each test addition, (c) Each task completion, (d) Each bug fix.",
    "failPolicy": "If ANY test fails, STOP IMMEDIATELY and fix the issue before proceeding. Zero tolerance for test failures, timing issues, non-determinism, or race conditions."
  }
}
