{
  "policy": "ALL tasks and subtasks contained within this blueprint MUST be completed in their entirety. Deferring, skipping, or omitting any part of the plan is strictly prohibited. Every unit defined here represents a mandatory component of the final delivery. 'Effective test coverage' means covering ALL code paths, edge cases, and error conditions - not just line coverage. This includes unreachable paths, error branches, and platform-specific code.",
  "coverageDefinition": {
    "effectiveCoverage": "Coverage of all logic paths, error branches, edge cases, and platform-specific code. Must handle null/undefined inputs, error propagation, concurrent access, and boundary conditions.",
    "targetMetrics": {
      "minimumLineCoverage": "100% of all possible code paths",
      "minimumBranchCoverage": "100% of all possible code paths",
      "minimumFunctionCoverage": "100% of all possible code paths",
      "errorPathCoverage": "100% not inclusive of TRULY unreachable code i.e. invariant assertions"
    }
  },
  "logicalChunks": [
    {
      "id": "LOGICAL_CHUNK_2",
      "name": "Eventloop Core & Timer ID System",
      "includedOriginalChunks": ["CHUNK_2", "CHUNK_3"],
      "files": ["eventloop/*"],
      "testStatus": "ALL PASS (200+ tests)",
      "currentCoverage": {
        "main": "77.1%",
        "internal/alternateone": "69.3%",
        "internal/alternatethree": "58.0%",
        "internal/alternatetwo": "73.0%"
      },
      "estimatedTestCount": "200+ tests",
      "scope": [
        "loop.go (1699 lines)",
        "js.go - JavaScript adapter",
        "promise.go - Promise/A+ implementation",
        "timer pool - High-performance timer scheduling",
        "metrics - Runtime metrics (latency, TPS, queue depth)",
        "performance optimizations - Fast path mode, microtask budget",
        "TimerID mapping removal from Goja adapter",
        "JS float64 encoding for timer IDs",
        "MAX_SAFE_INTEGER handling"
      ],
      "complexity": "HIGH",
      "status": "fixes-complete",
      "priority": "HIGH",
      "rationale": "FIXES COMPLETE - Both chunks have 'fixes-complete' status. ALL CRITICAL/HIGH BUGS FIXED and VERIFIED 2026-01-25. CRITICAL #1: Timer ID MAX_SAFE_INTEGER panic - FIXED. HIGH #1: Interval state TOCTOU race - DOCUMENTED AS ACCEPTABLE JS SEMANTICS. HIGH #2: Fast path starvation window - FIXED. Status: 'PRODUCTION-READY WITH MINOR CONCERNS'. Needs re-review for perfection.",
      "reviewDocument": "./eventloop/docs/reviews/22-EVENTLOOP_CORE_SCOPE-CHUNK2_CHUNK3.md",
      "fixDocument": "./eventloop/docs/reviews/22-EVENTLOOP_CORE-FIXES.md",
      "reviewDate": "2026-01-25",
      "fixDate": "2026-01-25",
      "reviewStatus": "ALL CRITICAL/HIGH BUGS FIXED - COMPLETED",
      "criticalIssues": [
        "CRITICAL #1: Timer ID MAX_SAFE_INTEGER panic with resource leak (js.go:209, js.go:307, js.go:428) - FIXED"
      ],
      "highPriorityIssues": [
        "HIGH #1: Interval state TOCTOU race (js.go:224-361) - documented behavior",
        "HIGH #2: Fast path starvation window (loop.go:830-900) - FIXED with drainAuxJobs() in poll()"
      ],
      "overallAssessment": "PRODUCTION-READY WITH MINOR CONCERNS - Need re-review for perfection",
      "reviewCycle": {
        "reviewTask": "LOGICAL_2.1",
        "fixTask": "LOGICAL_2.2",
        "reReviewTask": "LOGICAL_2.3"
      }
    }
  ],
  "reviewCycleTasks": [
    {
      "id": "LOGICAL_2.1",
      "title": "Review Eventloop Core & Timer ID System - First Iteration",
      "description": "Run #runSubagent with prompt: 'Ensure, or rather GUARANTEE the correctness of Eventloop Core & Timer ID System - specifically loop.go (1699 lines), js.go, promise.go, timer pool, metrics, performance optimizations, and Timer ID refactor (JS float64 encoding, MAX_SAFE_INTEGER handling). Since you're _guaranteeing_ it, sink commensurate effort; you care deeply about keeping your word, after all. Even then, I expect you to think very VERY hard, significantly harder than you might expect. Assume, from start to finish, that there's _always_ another problem, and you just haven't caught it yet. Question all information provided - _only_ if it is simply impossible to verify are you allowed to trust, and if you trust you MUST specify that (as briefly as possible). Provide a succinct summary then more detailed analysis. Your succinct summary must be such that removing any single part, or applying any transformation or adjustment of wording would make it materially worse. Write up your review to ./eventloop/docs/reviews/26-LOGICAL2_EVENTLOOP_CORE.md.'",
      "status": "not-started",
      "logicalChunkId": "LOGICAL_CHUNK_2",
      "reviewSequence": "26",
      "priority": "HIGH",
      "estimatedEffort": "3-4 hours"
    },
    {
      "id": "LOGICAL_2.2",
      "title": "Verify all fixes in Eventloop Core & Timer ID System",
      "description": "Verify that all previously completed fixes are correct: (1) Timer ID MAX_SAFE_INTEGER panic fix - verify check happens BEFORE scheduling in SetTimeout (already done for SetInterval and SetImmediate). (2) Interval state TOCTOU race - documented as acceptable JS semantics. (3) Fast path starvation window - verify drainAuxJobs() added to poll(). Create verification document at ./eventloop/docs/reviews/26-LOGICAL2_EVENTLOOP_CORE-VERIFICATION.md. Run 'go test ./eventloop/... -v' and 'go test ./eventloop/... -race' to verify 100% test pass rate with no race conditions.",
      "status": "not-started",
      "logicalChunkId": "LOGICAL_CHUNK_2",
      "priority": "HIGH",
      "estimatedEffort": "1-2 hours",
      "subtasks": [
        {
          "id": "LOGICAL_2.2.1",
          "title": "Verify Timer ID MAX_SAFE_INTEGER fix",
          "description": "Verify that SetTimeout checks MAX_SAFEInteger BEFORE calling ScheduleTimer to prevent resource leak. Same check should exist for SetInterval and SetImmediate.",
          "status": "not-started"
        },
        {
          "id": "LOGICAL_2.2.2",
          "title": "Verify Interval state TOCTOU documentation",
          "description": "Verify that TOCTOU race in interval is documented as acceptable JS semantics.",
          "status": "not-started"
        },
        {
          "id": "LOGICAL_2.2.3",
          "title": "Verify Fast path starvation fix",
          "description": "Verify that drainAuxJobs() is called in poll() path when not in fast path mode.",
          "status": "not-started"
        },
        {
          "id": "LOGICAL_2.2.4",
          "title": "Run full test suite and create verification doc",
          "description": "Run 'go test ./eventloop/... -v' and 'go test ./eventloop/... -race'. Verify 100% pass rate. Create ./eventloop/docs/reviews/26-LOGICAL2_EVENTLOOP_CORE-VERIFICATION.md documenting all verified fixes.",
          "status": "not-started",
          "dependsOn": ["LOGICAL_2.2.1", "LOGICAL_2.2.2", "LOGICAL_2.2.3"]
        }
      ]
    },
    {
      "id": "LOGICAL_2.3",
      "title": "Re-review Eventloop Core & Timer ID System for perfection - SECOND ITERATION",
      "description": "After all fixes are verified, run comprehensive re-review of Eventloop Core & Timer ID System to ensure NO REMAINING ISSUES. Use #runSubagent with review prompt: 'Ensure, or rather GUARANTEE the correctness of FIXED Eventloop Core & Timer ID System code. Since you're _guaranteeing_ it, sink commensurate effort. Verify: (1) All timer ID boundary conditions handled correctly, (2) No starvation in fast path mode, (3) All 200+ tests pass with no race conditions, (4) Performance metrics correct, (5) No memory leaks. Write up your review to ./eventloop/docs/reviews/27-LOGICAL2_EVENTLOOP_CORE-REVIEW.md.' If re-review finds ANY remaining issues, mark tasks LOGICAL_2.1, LOGICAL_2.2, and LOGICAL_2.3 as 'not-started' again and restart this chunk review cycle. Only mark complete when review is flawless with zero issues.",
      "status": "not-started",
      "logicalChunkId": "LOGICAL_CHUNK_2",
      "priority": "HIGH",
      "estimatedEffort": "2-3 hours",
      "dependsOn": ["LOGICAL_2.2"]
    }
  ],
  "testCoverageTasks": [
    {
      "id": "COVERAGE_1",
      "title": "Achieve 100% Effective Test Coverage - Eventloop Module (LOGICAL_CHUNK_2)",
      "description": "Achieve 100% effective test coverage for eventloop module. Current coverage: 77.1% main, 69.3% alternateone, 58.0% alternatethree, 73.0% alternatetwo. REQUIREMENTS: (1) All code paths covered, (2) All error branches tested, (3) All edge cases covered, (4) Platform-specific code tested where possible, (5) Race condition coverage with -race flag. TARGET METRICS: main >= 90%, alternateone >= 90%, alternatethree >= 85% (experimental), alternatetwo >= 90%.",
      "status": "not-started",
      "moduleId": "eventloop",
      "associatedLogicalChunk": "LOGICAL_CHUNK_2",
      "priority": "HIGH",
      "estimatedEffort": "4-6 hours",
      "verification": {
        "command": "go test -coverprofile=coverage.out ./eventloop/... && go tool cover -func=coverage.out | grep total",
        "targetCoverage": "90%"
      },
      "subtasks": [
        {
          "id": "COVERAGE_1.1",
          "title": "Analyze coverage gaps in internal/alternatethree (58.0%)",
          "description": "Run 'go test -coverprofile=coverage.out ./eventloop/internal/alternatethree/...' and 'go tool cover -html=coverage.out' to identify specific uncovered lines. Document all gaps in ./eventloop/docs/coverage-gaps-alternatethree.md.",
          "status": "not-started"
        },
        {
          "id": "COVERAGE_1.2",
          "title": "Add tests for uncovered paths in alternateone and alternatetwo",
          "description": "Create targeted tests for uncovered code paths in internal/alternateone (69.3%) and internal/alternatetwo (73.0%). Focus on error conditions, edge cases, and platform-specific branches.",
          "status": "not-started"
        },
        {
          "id": "COVERAGE_1.3",
          "title": "Add error path and edge case tests for main package",
          "description": "For the 22.9% uncovered in main package, add comprehensive tests for: (a) Timer ID overflow scenarios, (b) Promise error propagation, (c) Metrics edge cases, (d) Fast path boundary conditions, (e) Microtask budget exhaustion.",
          "status": "not-started"
        },
        {
          "id": "COVERAGE_1.4",
          "title": "Verify 90%+ effective coverage achieved",
          "description": "Run full coverage analysis: 'go test -coverprofile=coverage.out ./eventloop/... && go tool cover -html=coverage.out -o coverage.html'. Verify target metrics: main >= 90%, alternateone >= 90%, alternatethree >= 85%, alternatetwo >= 90%. Ensure all identified coverage gaps closed.",
          "status": "not-started"
        }
      ]
    },
    {
      "id": "COVERAGE_2",
      "title": "Achieve 100% Effective Test Coverage - Goja-Eventloop Module (LOGICAL_CHUNK_1)",
      "description": "Achieve 100% effective test coverage for goja-eventloop module. Current coverage: 74.9%. REQUIREMENTS: (1) All code paths covered, (2) All error branches tested, (3) Promise combinator edge cases (null/undefined inputs), (4) Timer ID boundary cases (MAX_SAFE_INTEGER), (5) Concurrent timer scheduling stress tests, (6) Deep promise chain scenarios (>10 .then() calls). TARGET METRICS: main >= 90%.",
      "status": "not-started",
      "moduleId": "goja-eventloop",
      "associatedLogicalChunk": "LOGICAL_CHUNK_1",
      "priority": "HIGH",
      "estimatedEffort": "3-4 hours",
      "verification": {
        "command": "go test -coverprofile=coverage.out ./goja-eventloop/... && go tool cover -func=coverage.out | grep total",
        "targetCoverage": "90%"
      },
      "subtasks": [
        {
          "id": "COVERAGE_2.1",
          "title": "Analyze coverage gaps in goja-eventloop (74.9%)",
          "description": "Run 'go test -coverprofile=coverage.out ./goja-eventloop/...' and 'go tool cover -html=coverage.out' to identify specific uncovered lines. Document all gaps in ./goja-eventloop/docs/coverage-gaps.md.",
          "status": "not-started"
        },
        {
          "id": "COVERAGE_2.2",
          "title": "Add Promise combinator edge case tests",
          "description": "Create comprehensive tests for Promise combinators (all, race, allSettled, any) covering: null inputs, undefined inputs, empty arrays, single element arrays, nested promises, mixed resolution/rejection scenarios. Test file: adapter_combinators_edge_test.go",
          "status": "not-started"
        },
        {
          "id": "COVERAGE_2.3",
          "title": "Add timer ID boundary tests",
          "description": "Create tests for timer ID boundaries: MAX_SAFE_INTEGER, overflow scenarios, ID reuse edge cases, concurrent timer scheduling with high IDs. Test file: adapter_timer_boundary_test.go",
          "status": "not-started"
        },
        {
          "id": "COVERAGE_2.4",
          "title": "Add deep promise chain tests",
          "description": "Create tests for deep promise chains: 10+ .then() calls, mixed resolution/rejection in chains, Promise.all with nested promises, error propagation in complex chains. Test file: adapter_deep_chain_test.go",
          "status": "not-started"
        },
        {
          "id": "COVERAGE_2.5",
          "title": "Verify 90%+ effective coverage achieved",
          "description": "Run full coverage analysis: 'go test -coverprofile=coverage.out ./goja-eventloop/... && go tool cover -html=coverage.out -o coverage.html'. Verify target metric: main >= 90%. Ensure all identified coverage gaps closed including error paths and edge cases.",
          "status": "not-started"
        }
      ]
    }
  ],
  "betteralignTasks": [
    {
      "id": "BETTERALIGN_1",
      "title": "Create custom config.mk target for betteralign",
      "description": "Add a custom target in config.mk for running betteralign on eventloop module. TARGET: 'betteralign-eventloop' with command: 'go -C eventloop tool betteralign -apply .'. This should automatically apply betteralign fixes for cache line padding optimization.",
      "status": "not-started",
      "priority": "HIGH",
      "associatedLogicalChunk": "LOGICAL_CHUNK_2",
      "subtasks": [
        {
          "id": "BETTERALIGN_1.1",
          "title": "Create/edit config.mk with betteralign target",
          "description": "Open config.mk and add: 'betteralign-eventloop:\n\t@echo \"Running betteralign on eventloop...\"\n\tgo -C eventloop tool betteralign -apply .\n\t@echo \"Betteralign complete\"'. Ensure file exists (create if missing).",
          "status": "not-started"
        },
        {
          "id": "BETTERALIGN_1.2",
          "title": "Add betteralign target to Makefile integration",
          "description": "Verify that betteralign-eventloop target is accessible via Makefile. Ensure it integrates with existing build targets.",
          "status": "not-started"
        }
      ]
    },
    {
      "id": "BETTERALIGN_2",
      "title": "Run betteralign on eventloop module",
      "description": "Execute the betteralign target using #make tool with custom target defined in config.mk. Command: 'make betteralign-eventloop'. Pipe output to build.log as per operational discipline.",
      "status": "not-started",
      "priority": "HIGH",
      "associatedLogicalChunk": "LOGICAL_CHUNK_2",
      "dependsOn": ["BETTERALIGN_1"]
    },
    {
      "id": "BETTERALIGN_3",
      "title": "Verify cache line padding is sane after betteralign",
      "description": "After betteralign applies changes, verify that cache line padding is still correct and doesn't introduce false sharing. REQUIREMENTS: (1) Check that hot data structures remain properly padded, (2) Verify no struct size changes that would affect cache line alignment, (3) Run stress tests to ensure no performance regression, (4) Check that betteralign didn't add excessive padding that wastes memory. VERIFICATION: 'make test' with benchmark comparison. Document any structural changes in ./eventloop/docs/betteralign-verification.md.",
      "status": "not-started",
      "priority": "HIGH",
      "associatedLogicalChunk": "LOGICAL_CHUNK_2",
      "dependsOn": ["BETTERALIGN_2"],
      "subtasks": [
        {
          "id": "BETTERALIGN_3.1",
          "title": "Review betteralign changes",
          "description": "Use 'git diff' to see what betteralign changed. Look for: struct field reordering, padding additions, size changes. Verify changes are minimal and targeted for cache line optimization.",
          "status": "not-started"
        },
        {
          "id": "BETTERALIGN_3.2",
          "title": "Run stress tests to verify no performance regression",
          "description": "Run 'make test -run Stress' and compare benchmarks before/after betteralign. Look for latency changes, throughput changes, or unexpected performance degradation.",
          "status": "not-started"
        },
        {
          "id": "BETTERALIGN_3.3",
          "title": "Document verification results",
          "description": "Create ./eventloop/docs/betteralign-verification.md documenting: (a) Changes made by betteralign, (b) Performance metrics comparison, (c) Cache line padding verification, (d) Conclusion on whether padding is still sane.",
          "status": "not-started"
        }
      ]
    }
  ],
  "continuousVerificationTasks": [
    {
      "id": "CONTINUOUS_1",
      "title": "Run make-all-with-log CONTINUOUSLY",
      "description": "Run 'make all' with full logging output after every significant change to ensure builds remain stable. Target: build.log. COMMAND: 'make all 2>&1 | fold -w 200 | tee build.log | tail -n 15'. This is a CONTINUOUS task - must be run after: (a) Each code change, (b) Each test addition, (c) Each review cycle completion, (d) Each bug fix. FAIL POLICY: If ANY test fails, STOP. Do not proceed. Fix the issue immediately. Zero tolerance for test failures, even due to timing or non-determinism.",
      "status": "not-started",
      "priority": "HIGHEST",
      "isContinuous": true
    },
    {
      "id": "CONTINUOUS_2",
      "title": "Run make-all-in-container CONTINUOUSLY",
      "description": "Run 'make all' in Docker container to verify cross-platform compatibility. This ensures code works correctly in clean environment. This is a CONTINUOUS task - must be run periodically (every 5-10 code changes) and certainly before release. COMMAND: 'make all-in-container' (or equivalent docker-compose command). FAIL POLICY: If container build fails or tests fail in container environment, STOP. Fix environment-specific issues immediately. Zero tolerance for platform-specific failures.",
      "status": "not-started",
      "priority": "HIGHEST",
      "isContinuous": true
    }
  ],
  "archivedHistoricalData": {
    "userRequestedVerification": {
      "title": "USER REQUESTED: Verify 5 Critical Safety Violation Fixes in goja-eventloop",
      "status": "completed",
      "description": "Verify compilation and test passage for 5 previously completed critical safety fixes. Documentation in VERIFICATION_SUMMARY.md.",
      "archivedDate": "2026-01-25"
    },
    "phase7ReviewGroups": {
      "description": "Historical Phase 7 review groups - completed and replaced by logical chunk structure",
      "archivedDate": "2026-01-25"
    },
    "originalChunkStructure": {
      "description": "Original 4-chunk structure (CHUNK_1, CHUNK_2, CHUNK_3, CHUNK_4) - merged into 2 logical chunks",
      "archivedDate": "2026-01-25"
    },
    "completedLogicalChunk1": {
      "title": "COMPLETED: Goja Integration & Specification Compliance (LOGICAL_CHUNK_1)",
      "status": "production-ready",
      "completionDate": "2026-01-25",
      "description": "Review cycle completed with PERFECT verdict. Files: goja-eventloop/* (adapter.go, Promise combinators, etc.). Test status: ALL PASS (18/18 tests). Coverage: 74.9% main. Critical issues: All 3 FIXED (CRITICAL #1: Double-wrapping, CRITICAL #2: Memory leak, CRITICAL #3: Promise.reject semantics). Review documents: 24-LOGICAL1_GOJA_SCOPE.md, 24-LOGICAL1_GOJA_SCOPE-FIXES.md, 25-LOGICAL1_GOJA_SCOPE-REVIEW.md. Status: PRODUCTION-READY - Ready for merge after LOGICAL_CHUNK_2 completion.",
      "completedTasks": ["LOGICAL_1.1", "LOGICAL_1.2", "LOGICAL_1.3"],
      "coverageTargets": "GOJA-EVENTLOOP: main currently 74.9%, needs 90%+ (COVERAGE_2 task pending)"
    }
  }
}
